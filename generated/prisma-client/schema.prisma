// FIX REFERENCE: FIX-20260129-04 - Output a carpeta dedicada para extraResources
generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma-client"
  binaryTargets = ["native", "debian-openssl-3.0.x", "windows", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Ingrediente {
  id          String   @id
  codigo      String   @unique
  nombre      String
  descripcion String?
  densidad    Float
  costo       Float
  stockActual Float
  stockMinimo Float    @default(100)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relación 1:N con Lotes (IMPL-20260129-01)
  // FIX REFERENCE: FIX-20260129-01 - Nombre en minúscula para consistencia con código
  lotes Lote[]

  @@index([codigo])
}

model Lote {
  id               String    @id
  ingredienteId    String
  numeroLote       String    @unique
  cantidad         Float
  fechaVencimiento DateTime?
  estado           String    @default("activo")
  createdAt        DateTime  @default(now())

  // ARCH-20260204-01: Campos para etiquetas QR
  codigoEtiqueta  String? @unique // "KT-1400-01" - Código único para QR
  etiquetaImpresa Boolean @default(false) // Flag para tracking

  // Relación inversa (FIX REFERENCE: FIX-20260129-01)
  ingrediente Ingrediente @relation(fields: [ingredienteId], references: [id], onDelete: Cascade)

  @@index([estado])
  @@index([ingredienteId])
  @@index([codigoEtiqueta]) // ARCH-20260204-01: Índice para búsquedas rápidas
}

model Mezcla {
  id             String   @id
  nodeId         String
  recetaId       String
  recetaNombre   String
  colorCode      String?
  fecha          DateTime @default(now()) // Fecha de registro (SQL: fecha)
  horaInicio     String? // SQL: horaInicio
  horaFin        String? // SQL: horaFin
  fechaCreacion  DateTime @default(now())
  estado         String   @default("pendiente")
  pesoTotal      Float
  pesoFinal      Float    @default(0) // SQL: pesoFinal
  pesoActual     Float    @default(0)
  ingredientes   String // JSON
  diferencia     Float    @default(0)
  tolerancia     Float    @default(0)
  tipoMezcla     String   @default("NUEVA")
  operadorId     Int? // Match User.id (Int)
  operadorNombre String?
  cliente        String?
  vehiculo       String?
  notas          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([fechaCreacion])
  @@index([estado])
  @@index([nodeId])
}

model SyncLog {
  id         String    @id
  tabla      String
  accion     String
  registroId String
  cambios    String
  nodeId     String
  syncedAt   DateTime?
  createdAt  DateTime  @default(now())

  @@index([tabla])
  @@index([syncedAt])
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  role      String
  nombre    String
  createdAt DateTime @default(now())
  active    Boolean  @default(true)

  @@index([active])
  @@index([username])
}
